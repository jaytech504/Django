{% extends "blog/base.html" %}
{% load static %}
{% block content %}
       <article class="media content-section">
        <img class="rounded-circle article-img"src="{{ object.author.profile.image.url}}">
  <div class="media-body">
    <div class="article-metadata">
      <a class="mr-2" href="{% url 'user-posts' object.author.username %}">{{ object.author }}</a>
      <small class="text-muted">{{ object.date_posted|date:"F d, Y" }}</small>
      {% if object.author == user %}
      <a class = "btn btn-secondary btn-sm mt-1 mb-1" href="{% url 'post-update' object.id %}">Edit</a>
      <a class = "btn btn-danger btn-sm mt-1 mb-1" href="{% url 'post-delete' object.id %}">Delete</a>

      {% endif %}
    </div>
    <h2 class="article-title">{{ object.title }}</h2>
    <p class="article-content">{{ object.content }}</p>
    <span class="like-btn" 
            data-post-id="{{ post.id }}">
        {% if user.is_authenticated and user_liked %}
            <i class="fa-heart fas"></i>
        {% else %}
            <i class="fa-heart far"></i>
        {% endif %}
  </span>
    <span id="like-count-{{ post.id }}">{{ post.like_set.count }}</span>
</div>
  </div>
</article>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript">
      $(document).ready(function(){
          $('.like-btn').click(function(){
              var postId = $(this).data('post-id');
              var button = $(this);
  
              $.ajax({
                  url: '/like/' + postId + '/',
                  method: 'POST',
                  headers: {'X-CSRFToken': '{{ csrf_token }}'},
                  success: function(response){
                      if(response.liked){
                          button.html('<i class="fa-heart fas"></i>');
                      } else {
                          button.html('<i class="fa-heart far"></i>');
                      }
                      $('#like-count-' + postId).text(response.like_count);
                  }
              });
          });
      });
  </script>
{% endblock content %}
